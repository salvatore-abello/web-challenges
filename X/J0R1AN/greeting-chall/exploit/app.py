from flask import Flask, send_from_directory, Response


app = Flask(__name__)
nonces = []


@app.after_request
def add_cors_headers(response):
    response.headers['Access-Control-Allow-Origin'] = '*'
    return response

@app.get("/nonce")
def serve_last_nonce():
    return {"nonce": nonces[-1] if nonces else None}

@app.get("/")
@app.get("/<path:path>")
def serve(path="index.html"):
    if "." not in path:
        nonces.append(path)
        return Response("", content_type="image/png")
    
    try:
        return send_from_directory(".", path)
    except Exception:
        return ""

if __name__ == "__main__":
    app.run("0.0.0.0", 1337)